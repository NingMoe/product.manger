<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.phicomm.product.manger.dao.BalanceStatusMapper">

    <select id="obtainCountByMonth" resultType="com.phicomm.product.manger.model.statistic.CountBean"
            parameterType="java.lang.Integer">
        <![CDATA[

        SELECT
            DATE_FORMAT(dayTime, '%Y-%m') AS generateTime,
            SUM(dayCount) AS generateCount
        FROM
        (
        SELECT
            DATE_FORMAT(create_time, '%Y-%m-%d') AS dayTime,
            COUNT(1) AS dayCount
        FROM
            `balance_status_info`
        GROUP BY
            dayTime
        HAVING
            dayTime < DATE_FORMAT(NOW(), '%Y-%m-%d')
            ) b
        GROUP BY
            generateTime
        HAVING
            generateTime > DATE_FORMAT(
            DATE_ADD(NOW(), INTERVAL - #{month,jdbcType=INTEGER} MONTH),
            '%Y-%m'
            )
        ORDER BY
            generateTime DESC

        ]]>
    </select>

    <select id="obtainCountByDay" resultType="com.phicomm.product.manger.model.statistic.CountBean"
            parameterType="java.lang.Integer">
        <![CDATA[

        SELECT
            DATE_FORMAT(create_time, '%Y-%m-%d') AS generateTime,
            COUNT(1) AS generateCount
        FROM
            `balance_status_info`
        GROUP BY
            generateTime
        HAVING
            generateTime >= DATE_FORMAT(
            DATE_ADD(NOW(), INTERVAL - #{day,jdbcType=INTEGER} DAY),
            '%Y-%m-%d'
            )
        AND
            generateTime<DATE_FORMAT(NOW(),'%Y-%m-%d')
        ORDER BY
            generateTime DESC

        ]]>
    </select>

</mapper>